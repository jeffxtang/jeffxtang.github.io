---
layout: post
comments: true
title:  "TensorFlow Deep Learning Machine ezDIY"
date:   2017-02-14 01:03:06
categories: deep learning, hardware, GPU, performance
---

If you're thinking of buying or building your own deep learning machine with some nice GPU for training, you may have come across [Andrej Karpathy's tweet about his deep learning rig build](https://twitter.com/karpathy/status/648256662554341377?lang=en), which was a little outdated, being published in Sep. 2015, or more recently [Lukas Biewald's Build a super fast deep learning machine for under $1,000](https://www.oreilly.com/learning/build-a-super-fast-deep-learning-machine-for-under-1000), published on Feb. 1, 2017. I happened to start exploring training some CNN and RNN models since mid-January on my own machine, and am pretty happy with what I ended up with - a very cost effective Dell PC (Intel i7-6700 Processor 3.4GHz CPU, 16GB memory, 2TB Sata hard drive, 4GB Nvidia GTX 745) for $849 and a Nvidia GTX 8GB 1070 GPU for $388 - the total is $1237, $237 more than Lukas's machine but his GPU is 3GB GTX 1060 (about $200 less than 8GB GTX 1070, and 1070 is about 50% faster than 1060), 8GB memory ($129), 1TB hard drive ($50), and Intel i5-6600 3.3GHz CPU. So with $237 more, you get the value of about $400, plus you just need to replace the GPU instead of building the whole machine from scratch, and the Dell machine comes with Windows 10 Professional, which may sound not too sexy or geeky but its remote desktop feature can definitely make your life more enjoyable (I'll talk more about this later).

Here's a quick summary of my past month of experience of setting up my own deep learning machine:

First, I bought a [Dell XPS Tower with 8GB Nvidia GTX 1070](https://www.costco.com/Dell-XPS-Tower-Special-Edition---Intel-Core-i7---8GB-NVIDIA-Graphics.product.100307806.html) from Costco for $1,499 (after $150 discount from their current $1,649 in early January).

I tried to install Ubuntu alongside with Windows 10 for a couple of days, battled with BIOS, UEFI, partitions, etc, but was unable to get it done. Meanwhile, installing TensorFlow (both its GPU and CPU versions, using Anaconda, for performance comparisons) on Windows was a breeze, so was the Nvidia CUDA toolkit and cuDNN installation. I planned to install Torch and Caffe along with TensorFlow on Ubuntu, but I was getting more and more comfortable with TensorFlow and found that some well-known projects such as Andrej's char-rnn and Justin Johnson's Neural Style have all been ported to TensorFlow, so I decided to stay with Windows and TensorFlow for now. For Ubuntu, I do hope Madonna is right: "It takes more strength to cry, admit defeat."

Then I found on Costco another $650-less [Dell for only $849](https://www.costco.com/Dell-XPS-8900-Desktop---Intel-Core-i7---4GB-NVIDIA-Graphics.product.100293015.html). It has the same 16GB memory and 2TB hard drive, but a slightly slower 3.4GHz CPU and 4GB NVIDIA GTX 745 GPU. I was curious to test run some CNN and RNN training and compare the performance of GTX 1070 and 745, and found that, when running the training of [a neural style model](https://github.com/anishathalye/neural-style) or [another one](https://github.com/log0/neural-style-painting), or [the fast neural style one](https://github.com/lengstrom/fast-style-transfer), the [GTX 745 and 1070 comparison benchmark](http://gpu.userbenchmark.com/Compare/Nvidia-GTX-745-OEM-vs-Nvidia-GTX-1070/2638vs3609) is pretty accurate: 1070 is indeed 7-8 times faster. By the way, you can see from the GPU benchmark site that 1080 is about 26% faster than 1070, with about $200 more.

So it's obvious that GTX 745 is way too slow, compared with 1070. So I bought [EVGA GeForce GTX 1070 from Amazon](https://www.amazon.com/gp/product/B01GX5YWAO/ref=oh_aui_detailpage_o00_s00?ie=UTF8&psc=1) for $388. Replacing the GTX 745 that came with the Dell machine with 1070 was pretty easy - although I wondered for a moment if 1070 would fit in the Dell case as the size of 1070 is several times bigger than that of 745!

Not surprisingly, running the training on the two Dell machines both with GTX 1070 GPU takes about the same time. But there's another nice benefit that comes with the cheaper Dell machine: it has Windows 10 Professional built in; the more expensive one only comes with Windows 10 Home. I'd really like to remote control my Windows PC from my MacBook Air or Pro when I prefer to lean back and give my neck a nice rest, and only Windows 10 Professional lets your PC be controlled remotely - just go to Apple's App Store and download the free Microsoft Remote Desktop app. There're some other possible remote control solutions that may apply to Windows 10 Home but I don't feel too comfortable with them.

Some final notes on GPU/CPU performance tests:

* Running `python neural_style.py` of the [TensorFlow Neural Style project](https://github.com/anishathalye/neural-style) takes about 4 minutes on GTX 1070, compared to 26 minutes on 745, and 2.5 minutes on Titan X (Pascal) as specified by the project author. This is consistent with the GPU [benchmark of 1070 vs Titan X Pascal](http://gpu.userbenchmark.com/Compare/Nvidia-Titan-X-Pascal-vs-Nvidia-GTX-1070/m158352vs3609). But Titan X Pascal is about $1,100 more expensive than 1070. Even the Titan X Maxwell (a previous generation of GPU architecture before Pascal), slightly slower than 1070, is $700 more expensive.

* Running `python train.py` of the [TensorFlow char-rnn project](https://github.com/sherjilozair/char-rnn-tensorflow) takes 0.039 second per batch on GTX 1070, 0.063 per batch on GTX 745 (but it takes much longer on GTX 745 than on 1070 for the CNN training as shown above), 0.094 on $849 Windows i7-6700 Processor 3.4GHz CPU, and 0.110 on the latest MacBook Pro with 2.6GHz quad-core Intel Core i7 processor and cost over $3,000.

Another surprisingly positive impression to me is Windows 10. I pretty much abandoned Windows since I entered the iOS world in 2009 but my recent renewed experience with Windows has been nothing but pleasant. Of course, I still can't live without Mac and iOS as deep learning and AI on mobile, anytime and anywhere, is one of my main goals, but I've come to realize that sometimes the best indeed comes out of a mix of many different things - this calls for an open mind, a mind knowing that even a closed system or a system that used to suck may also be a nice integral part of a great open and complete system.

And, fortunately my wife won't read this blog of mine or check my home office carefully (Happy Valentine's Day, Sweetie!) - I plan to keep both Dell systems, to try distributed training one day and to avoid single point of failure of my deep learning training effort. But if you just need to start with a decent deep learning machine with a very cost-effective GPU, I'd recommend the nice Dell XPS and GTX 1070 for $1,237 - actually less than $1,200, as you should be able to sell the GTX 745 for over $50 on eBay. Guess I'm really trying to move towards Lukas's "Building a super fast deep learning machine for under $1,000".
